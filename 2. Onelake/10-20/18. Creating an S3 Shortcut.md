Of course. Here is the detailed, long-form study note for topic #14.

---

# Topic 14: Creating an S3 Shortcut

*   The ability to create an **external shortcut to an Amazon Web Services (AWS) S3 bucket** is a premier feature of OneLake, exemplifying its commitment to being an open, multi-cloud data platform.
*   This feature allows organizations to directly integrate and analyze data residing in the AWS cloud from within Microsoft Fabric, without undergoing a costly and complex data migration. It is a powerful tool for companies that have a multi-cloud strategy, have acquired other businesses that run on AWS, or have specific applications that natively write their output to S3.
*   Creating an S3 shortcut is a two-step process: first, you must create a secure **Cloud Connection** to store the AWS credentials, and second, you use that connection to create the shortcut itself, pointing it to a specific S3 bucket and path.

> [!IMPORTANT]
> The S3 shortcut does **not** move or copy data. It is a live, virtualized pointer. When a Fabric compute engine (like Spark or Power BI) queries the shortcut, it sends real-time read requests to the S3 API. This means performance is subject to cross-cloud network latency, and data reads will incur **data egress charges** from AWS.

## **Prerequisites**

*   Before you can create an S3 shortcut in Fabric, you need to have the necessary permissions and credentials prepared in your AWS account.

*   **### 1. AWS Identity and Access Management (IAM) User**
    *   It is a strong security best practice to create a dedicated IAM user in your AWS account specifically for this Fabric integration. Do not use your root account credentials.
    *   This IAM user must have **programmatic access** enabled, which will generate an **Access Key ID** and a **Secret Access Key**. These two values are the "username" and "password" that Fabric will use to authenticate to the S3 API.
        > [!WARNING]
        > The Secret Access Key is shown only **once** upon creation. You must save it in a secure location immediately. If you lose it, you must generate a new key pair.

*   **### 2. IAM Policy and Permissions**
    *   You must create an IAM policy that grants this user the minimum required permissions on the S3 bucket. Adhere to the principle of least privilege.
    *   **For a read-only shortcut**, the policy only needs to allow the following actions on the target bucket and its objects:
        *   `s3:GetObject` (Allows reading of file content)
        *   `s3:ListBucket` (Allows listing of files within the bucket/prefix)
        *   `s3:GetBucketLocation` (Allows the connector to determine the bucket's region)
    *   **Example Read-Only IAM Policy:**
        ```json
        {
            "Version": "2012-10-17",
            "Statement": [
                {
                    "Effect": "Allow",
                    "Action": [
                        "s3:GetObject",
                        "s3:ListBucket",
                        "s3:GetBucketLocation"
                    ],
                    "Resource": [
                        "arn:aws:s3:::your-target-bucket-name",
                        "arn:aws:s3:::your-target-bucket-name/*"
                    ]
                }
            ]
        }
        ```
    *   Attach this policy to the dedicated IAM user you created.

## **Step-by-Step Guide to Creating the Shortcut**

*   The process is performed entirely within the Microsoft Fabric web UI.

### **Part 1: Creating the Cloud Connection**

1.  **Navigate to Manage Connections:** Go to the Fabric settings menu (the gear icon in the top right) and select "Manage connections and gateways."
2.  **New Connection:** Click on "+ New".
3.  **Select Connection Type:** In the dialog, find and select "Amazon S3".
4.  **Configure Connection Settings:** Fill in the required fields:
    *   **Connection name:** A user-friendly name for the connection (e.g., `AWS_Prod_Marketing_S3_ReadOnly`).
    *   **Authentication kind:** This will be `Access Key`.
    *   **Access Key ID:** Paste the Access Key ID from the IAM user you created in AWS.
    *   **Secret Access Key:** Paste the Secret Access Key that you saved.
5.  **Privacy Level:** Choose the appropriate privacy level (Organizational or Private) depending on who should be able to use this connection.
6.  **Create:** Click "Create" to save the connection. Fabric encrypts and securely stores these credentials.

> [!TIP]
> Create the connection once and reuse it for multiple shortcuts. This centralizes credential management. If the keys ever need to be rotated, you only have to update them in one place: the Cloud Connection settings.

### **Part 2: Creating the S3 Shortcut**

1.  **Navigate to Your Lakehouse:** Go to the Fabric workspace and open the Lakehouse where you want the S3 data to appear.
2.  **Initiate Shortcut Creation:** In the Lakehouse Explorer pane, click the ellipsis (`...`) next to either the `/Tables` or `/Files` directory and select "New shortcut." The location you choose depends on the type of data you are linking to.
    *   Choose `/Tables` if you are pointing to a folder that is already in a valid Delta Lake format.
    *   Choose `/Files` for any other data type (CSV, Parquet, JSON, etc.).
3.  **Select External Source:** In the "New shortcut" dialog, select "Amazon S3".
4.  **Provide Shortcut Details:**
    *   **Connection:** Select the Cloud Connection you created in Part 1 from the dropdown list.
    *   **Bucket name:** Enter the exact name of the target S3 bucket (e.g., `my-company-raw-data`).
    *   **Prefix (Optional):** Enter the specific folder path within the bucket you want to link to (e.g., `landing/orders/`). If left blank, the shortcut will point to the root of the bucket.
    *   **Shortcut name:** Enter the name for the folder that will appear in your Lakehouse (e.g., `S3_Raw_Orders`).
5.  **Create:** Click "Create".

*   **Result:** After a few moments, a new folder with a link icon will appear in your Lakehouse Explorer. You can now navigate this folder, and Fabric will make live API calls to S3 to list and read the files, making the remote data appear as if it were local to OneLake.

## **Use Cases and Scenarios**

*   **### Cross-Cloud Data Engineering**
    *   **Scenario:** A web application running on AWS EC2 instances generates hourly log files and writes them to a central S3 bucket. A data engineering team using Fabric needs to process these logs to extract user activity metrics.
    *   **Implementation:** An S3 shortcut is created in a "Bronze" Lakehouse, pointing to the log file directory in S3. A Fabric Spark Notebook can then directly read the files from this shortcut path (`/Files/S3_Raw_Logs/`), parse them, and write the curated results to a managed Delta table in the "Silver" layer of the Lakehouse. This completely eliminates the need for a separate data transfer service like AWS DataSync or Azure Data Factory to copy the data first.

*   **### BI on Multi-Cloud Data**
    *   **Scenario:** A marketing department uses a third-party SaaS platform that dumps its campaign performance reports as CSV files into a dedicated S3 bucket. The BI team needs to join this marketing data with the company's internal sales data, which is in a Fabric Warehouse.
    *   **Implementation:** An S3 shortcut is created to the marketing reports folder. A Fabric Dataflow Gen2 can then be used to read the CSV files from the S3 shortcut, apply transformations, and load them into a staging table in the Fabric Warehouse. From there, it can be joined with the sales data to create a unified Power BI report.

*   **### Unified Data Governance**
    *   **Scenario:** A company has data assets spread across both Azure and AWS. The Chief Data Officer wants a single, unified catalog of all data assets, regardless of where they are physically stored.
    *   **Implementation:** By creating S3 shortcuts for all key AWS datasets, they are surfaced within OneLake. Microsoft Purview can then be configured to scan the entire Fabric tenant. When Purview scans the Lakehouses, it will discover the S3 shortcuts and catalog the underlying S3 data as if it were a native Fabric asset, allowing for centralized tagging, classification, and lineage tracking.

## **Common Pitfalls / Mistakes**

*   **Mistake 1: Using Overly-Broad IAM Permissions.**
    *   **Pitfall:** To make it "easy," a developer uses an IAM user with full `S3:*` (administrator) permissions.
    *   **Correction:** This is a major security risk. If the credentials were ever compromised, an attacker could delete the entire S3 bucket. Always follow the principle of least privilege and create a policy that only grants the specific `s3:GetObject` and `s3:ListBucket` permissions required for reading.

*   **Mistake 2: Forgetting about AWS Egress Costs.**
    *   **Pitfall:** A team creates an S3 shortcut to a multi-terabyte dataset and starts running large, exploratory Spark queries that perform full table scans. They are shocked by the large AWS bill at the end of the month.
    *   **Correction:**
        > [!CAUTION]
        > AWS charges for data transferred out of its network. Every byte read by a Fabric query on an S3 shortcut counts as egress. For frequent, large-scale analytical queries, it may be more cost-effective to ingest a copy of the data into OneLake. Use shortcuts for targeted queries, data exploration, or when the cost of ingestion outweighs the cost of egress.

*   **Mistake 3: Incorrectly Specifying the S3 Path (Bucket vs. Prefix).**
    *   **Pitfall:** A user enters the full path `my-bucket/landing/orders` in the "Bucket name" field. The shortcut creation fails.
    *   **Correction:** The fields are separate. The "Bucket name" field should contain *only* the name of the bucket (e.g., `my-bucket`). The folder path *within* the bucket should be entered into the "Prefix" field (e.g., `landing/orders/`).

*   **Mistake 4: Region-Specific Performance Issues.**
    *   **Pitfall:** The Fabric Capacity is in the `East US` Azure region, but the S3 bucket is in the `ap-southeast-2` (Sydney, Australia) region. Queries against the shortcut are very slow.
    *   **Correction:** The physical distance between the compute (Fabric) and the storage (S3) introduces significant network latency. For optimal performance, the S3 bucket and the Fabric Capacity should be in AWS and Azure regions that are geographically close and have good network peering (e.g., `AWS us-east-1` and `Azure East US`).

## **Flashcards (Q&A)**

*   **Q: What two main pieces of information do you need from an AWS IAM user to create an S3 connection in Fabric?**
    *   A: The Access Key ID and the Secret Access Key.
*   **Q: What is the most critical mistake to avoid regarding AWS permissions?**
    *   A: Granting overly broad permissions. You should always use a policy with the minimum required permissions (least privilege).
*   **Q: Does creating an S3 shortcut copy the data from S3 to OneLake?**
    *   A: No, it is a virtual pointer. Data is read directly from S3 in real-time when a query is run.
*   **Q: What is the "hidden cost" associated with querying S3 shortcuts?**
    *   A: AWS data egress fees for data transferred out of the AWS network.
*   **Q: What is the difference between the "Bucket name" and "Prefix" fields when creating the shortcut?**
    *   A: "Bucket name" is just the name of the S3 bucket itself. "Prefix" is the folder path inside the bucket.
*   **Q: What is the first step you must take in Fabric before you can create the shortcut itself?**
    *   A: You must create a Cloud Connection to securely store the AWS credentials.
*   **Q: If new files are added to the target folder in S3, will they appear in the Fabric shortcut?**
    *   A: Yes, automatically. The shortcut provides a live view of the target directory.
*   **Q: Can you create a shortcut that allows you to *write* data back to S3 from Fabric?**
    *   A: As of the current implementation, S3 shortcuts are read-only. Write operations are not supported.
*   **Q: How can S3 shortcuts help with multi-cloud governance?**
    *   A: By surfacing S3 data within OneLake, it can be discovered, scanned, and cataloged by Microsoft Purview, creating a single pane of glass for governance.
*   **Q: For best performance, what should you consider regarding the physical location of your S3 bucket and Fabric capacity?**
    *   A: They should be located in AWS and Azure regions that are geographically close to each other to minimize network latency.
